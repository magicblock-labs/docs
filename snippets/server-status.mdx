export const ServerStatus = () => {
  const [selectedNetwork, setSelectedNetwork] = useState('mainnet')

  const StatusBar = ({ title, statusText, statusData, days, explorerLink }) => {
  const [hoveredDay, setHoveredDay] = useState(null)
  const [tooltipPosition, setTooltipPosition] = useState({ x: 0, y: 0 })
  const [hoveredStatus, setHoveredStatus] = useState(false)
  const [statusTooltipPosition, setStatusTooltipPosition] = useState({ x: 0, y: 0 })

  const getBarColor = (downtimeMinutes) => {
    if (downtimeMinutes > 60) return 'bg-red-600'
    if (downtimeMinutes > 15) return 'bg-orange-600'
    return 'bg-green-600'
  }

  const calculateUptime = () => {
    const totalMinutes = days * 24 * 60
    const downtimeMinutes = statusData.reduce((sum, minutes) => sum + minutes, 0)
    const uptimePercentage = ((totalMinutes - downtimeMinutes) / totalMinutes) * 100
    return uptimePercentage.toFixed(2)
  }

  const handleMouseEnter = (index, event) => {
    setHoveredDay(index)
    const rect = event.target.getBoundingClientRect()
    setTooltipPosition({
      x: rect.left + rect.width / 2,
      y: rect.top - 10
    })
  }

  const handleStatusMouseEnter = (event) => {
    setHoveredStatus(true)
    const rect = event.target.getBoundingClientRect()
    setStatusTooltipPosition({
      x: rect.left + rect.width / 2,
      y: rect.top - 10
    })
  }

  const getLastPing = () => {
    return Math.floor(Math.random() * 10) + 1
  }

  const isDown = statusText.toLowerCase() === 'down'

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <div className="flex items-center gap-2">
          <h3 className="text-sm text-gray-800 dark:text-white">{title}</h3>
          {explorerLink && (
            <a 
              href={explorerLink}
              target="_blank"
              rel="noopener noreferrer"
              className="text-[10px] text-gray-800 dark:text-gray-900 hover:text-gray-700 dark:hover:text-gray-300 underline"
            >
              1111....1111
            </a>
          )}
        </div>
        <div className="flex items-center gap-2">
          <div className={`w-2 h-2 rounded-full animate-pulse ${isDown ? 'bg-red-500' : 'bg-green-500'}`}></div>
          <span 
            className={`font-semibold text-sm cursor-pointer ${isDown ? 'text-red-500' : 'text-green-500'}`}
            onMouseEnter={handleStatusMouseEnter}
            onMouseLeave={() => setHoveredStatus(false)}
          >
            {statusText}
          </span>
        </div>
      </div>

      <div className="space-y-2">
        <div className="flex space-x-1">
          {statusData.map((downtimeMinutes, index) => (
            <div
              key={index}
              className={`h-8 flex-1 cursor-pointer transition-all duration-200 hover:opacity-80 ${getBarColor(downtimeMinutes)}`}
              onMouseEnter={(e) => handleMouseEnter(index, e)}
              onMouseLeave={() => setHoveredDay(null)}
              title={`Day ${index + 1}: ${downtimeMinutes} minutes downtime`}
            />
          ))}
        </div>

        <div className="flex justify-between items-center text-sm text-gray-600 dark:text-gray-400">
          <span>{days} days ago</span>
          <span className="text-gray-700 dark:text-gray-300 font-medium">
            {calculateUptime()}% uptime
          </span>
          <span>Today</span>
        </div>
      </div>

      {hoveredDay !== null && (
        <div 
          className="fixed bg-gray-800 text-white rounded-lg text-sm shadow-lg z-50 pointer-events-none -translate-y-full flex flex-col"
          style={{
            left: `${tooltipPosition.x}px`,
            top: `${tooltipPosition.y}px`,
            minWidth: '250px',
            minHeight: '110px',
          }}
        >
          <div className="px-4 pt-3 pb-2">
            <div className="text-xs text-gray-300">08-10-2025</div>
          </div>
          <div className="border-t border-gray-700 mx-3"></div>
          <div className="px-4 pt-2 pb-3">
            {statusData[hoveredDay] === 0 ? (
              <div className="text-s">No downtime recorded on this day.</div>
            ) : (
              <span className="inline-block bg-orange-500 text-black text-xs font-semibold px-3 py-1 rounded-full">
                ⚠️ {statusData[hoveredDay]} minutes downtime
              </span>
            )}
          </div>
        </div>
      )}

      {hoveredStatus && (
        <div 
          className="fixed bg-black text-white px-3 py-2 rounded-lg text-sm shadow-lg z-50 pointer-events-none transform -translate-x-1/2 -translate-y-full"
          style={{
            left: `${statusTooltipPosition.x}px`,
            top: `${statusTooltipPosition.y}px`
          }}
        >
          Last ping: {getLastPing()}min ago
        </div>
      )}
    </div>
  )
}
  useEffect(() => {
    fetch('https://www.google.com')
      .then(response => console.log(response))
      .catch(error => console.log(error))
  }, [])

  const mainnetStatusData1 = Array.from({ length: 60 }, (_, index) => {
    if (index === 10) return 30
    if (index === 20) return 200
    return 0
  })

  const mainnetStatusData2 = Array.from({ length: 60 }, (_, index) => {
    if (index === 15) return 45
    if (index === 25) return 180
    return 0
  })

  const devnetStatusData1 = Array.from({ length: 60 }, (_, index) => {
    if (index === 5) return 15
    if (index === 12) return 90
    return 0
  })

  const devnetStatusData2 = Array.from({ length: 60 }, (_, index) => {
    if (index === 8) return 60
    if (index === 18) return 120
    return 0
  })

  return (
    <div className="p-6 rounded-lg not-prose relative">
      <div className="mb-6">
        <div className="flex gap-2 border-b border-gray-300 dark:border-gray-700">
          <button
            onClick={() => setSelectedNetwork('mainnet')}
            className={`px-4 py-2 text-sm font-medium transition-colors ${
              selectedNetwork === 'mainnet'
                ? 'text-gray-900 dark:text-white border-b-2 border-gray-900 dark:border-white'
                : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'
            }`}
          >
            Mainnet
          </button>
          <button
            onClick={() => setSelectedNetwork('devnet')}
            className={`px-4 py-2 text-sm font-medium transition-colors ${
              selectedNetwork === 'devnet'
                ? 'text-gray-900 dark:text-white border-b-2 border-gray-900 dark:border-white'
                : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'
            }`}
          >
            Devnet
          </button>
        </div>
      </div>
      <div className="space-y-8">
        {selectedNetwork === 'mainnet' ? (
          <>
            <StatusBar title="Ephemeral Rollup - Asia" statusText="Operational" statusData={mainnetStatusData1} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=mainnet-beta" />
            <StatusBar title="Ephemeral Rollup - Europe" statusText="Down" statusData={mainnetStatusData1} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=mainnet-beta" />
            <StatusBar title="Ephemeral Rollup - US" statusText="Operational" statusData={mainnetStatusData1} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=mainnet-beta" /> 
            <StatusBar title="VRF Oracle" statusText="Operational" statusData={mainnetStatusData2} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=mainnet-beta" />
            <StatusBar title="Pyth Oracle" statusText="Operational" statusData={mainnetStatusData2} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=mainnet-beta" />
          </>
        ) : (
          <>
            <StatusBar title="Ephemeral Rollup - Asia" statusText="Operational" statusData={devnetStatusData1} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=devnet" />
            <StatusBar title="Ephemeral Rollup - Europe" statusText="Operational" statusData={devnetStatusData1} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=devnet" />
            <StatusBar title="Ephemeral Rollup - US" statusText="Operational" statusData={devnetStatusData1} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=devnet" /> 
            <StatusBar title="VRF Oracle" statusText="Operational" statusData={mainnetStatusData2} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=devnet" />
            <StatusBar title="Pyth Oracle" statusText="Operational" statusData={devnetStatusData2} days={60} explorerLink="https://explorer.solana.com/address/11111111111111111111111111111111?cluster=devnet" />
          </>
        )}
      </div>
    </div>
  )
}