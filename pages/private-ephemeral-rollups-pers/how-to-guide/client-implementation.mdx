---
title: "Client Implementation"
description: "Enable privacy in any Solana program state account through MagicBlock's ER and Trusted Execution Environment on Intel TDX."
---

import PerCards from "/snippets/per-cards.mdx";

import QuickAccessPER from "/snippets/quick-access-per.mdx";

import CreateWeb3jsCode from "/snippets/per-web3js-code/create.mdx";
import DelegateWeb3jsCode from "/snippets/per-web3js-code/delegate.mdx";
import UpdateWeb3jsCode from "/snippets/per-web3js-code/update.mdx";
import UndelegateWeb3jsCode from "/snippets/per-web3js-code/commit-and-undelegate.mdx";
import CloseWeb3jsCode from "/snippets/per-web3js-code/close.mdx";

---

<QuickAccessPER />

---

### Client Implementation

Frontends interface with the Private Ephemeral Rollup (PER) using two concepts: Authorization and Permissions

- **Authorization**: Verify RPC integrity, request authorization token and create connection.
- **Permissions**: Manage permissions from the client and define members with fine-grained access to permissioned accounts.

### Authorization

1. Verify the TEE RPC server runs on genuine Intel TDX hardware using its TDX quote and Intel-issued attestation certificates
2. Request and sign challenge to receive an authorization token
3. Create connection by passing the authorization token inside header or as query parameter

```typescript
import {
  verifyTeeRpcIntegrity,
  getAuthToken,
} from "@magicblock-labs/ephemeral-rollups-sdk";

// if not using wallet:
// import * as nacl from "tweetnacl";

const teeUrl = "https://tee.magicblock.app";
const teeWsUrl = "wss://tee.magicblock.app";

// 1. Verify the integrity of TEE RPC
const isVerified = await verifyTeeRpcIntegrity(teeUrl);

// 2. Get AuthToken before making request to TEE
const token = await getAuthToken(
  teeUrl,
  wallet.publicKey,
  signMessage
  // if not using wallet:
  // (message: Uint8Array) =>
  //  Promise.resolve(nacl.sign.detached(message, wallet.secretKey))
);

// 3. Create connection with TEE
const connection = new web3.Connection(`${teeUrl}?token=${authToken.token}`, {
  wsEndpoint: `${teeWsUrl}?token=${authToken.token}`,
});
```

### Permissions

Create permissions on Solana, manage and enforce them in the Private Ephemeral Rollup through delegation:

<Tabs>
  <Tab title="1. Create">
    Create permission for account through CPI call to Permission Program:
    <CreateWeb3jsCode />
    [⬆️ Back to Top](#code-snippets)
  </Tab>
  <Tab title="2. Delegate">
    Delegate permission and permissioned account to enforce privacy:
    <DelegateWeb3jsCode />
    [⬆️ Back to Top](#code-snippets)
  </Tab>
  <Tab title="3. Update">
    Make permissioned account visible in PER:
    <UpdateWeb3jsCode />
    [⬆️ Back to Top](#code-snippets)
  </Tab>
  <Tab title="4. Undelegate">
    Commit and undelegate permissions to Solana:
    <UndelegateWeb3jsCode />
    [⬆️ Back to Top](#code-snippets)
  </Tab>
  <Tab title="5. Close">
    Close permission to receive deposit back:
    <CloseWeb3jsCode />
    [⬆️ Back to Top](#code-snippets)
  </Tab>
</Tabs>

import PerEndpoint from "/snippets/per-endpoint.mdx";

<PerEndpoint />

---

<PerCards />
