---
title: "Local Development"
description: "Run and test your Native Rust or Anchor programs with full customization on your local host and Ephemeral Rollups minimizing network latency and rate limit risk."
---

import Validators from "/snippets/validators.mdx";

---

### ⚠️ Important: Upgrade your program with local validator identity

> When using a local ER validator, you need to connect it to your preferred base layer (e.g., `mainnet-beta`, `devnet`, or `localhost`) where the accounts are delegated. To delegate your PDA to a `specific ER validator identity`, you must update the `delegation config` in your program. This ensures that accounts can be properly committed and undelegated on the base layer.

<Validators />

---

### Deploy and test on base layer via correct validator identity

<Tabs>
<Tab title="solana-test-validator (localhost)">
    <Steps>
      <Step title="Set up Solana Test Validator (Localhost) and deploy your upgraded program">
        1. Install `solana-test-validator`:
        ```bash
        sh -c "$(curl -sSfL https://release.anza.xyz/stable/install)"
        ```

        2. Run `solana-test-validator` with cloned delegation program and accounts from Devnet:
        ```bash
        solana-test-validator \
          --ledger ./my-ledger-1 \
          --reset \
          --clone mAGicPQYBMvcYveUZA5F5UNNwyHvfYh5xkLS2Fr1mev \
          --clone EpJnX7ueXk7fKojBymqmVuCuwyhDQsYcLVL1XMsBbvDX \
          --clone 7JrkjmZPprHwtuvtuGTXp9hwfGYFAQLnLeFM52kqAgXg \
          --clone noopb9bkMVfRPU8AsbpTUg8AQkHtKwMYZiFUjNRtMmV \
          --clone-upgradeable-program DELeGGvXpWV2fqJUhqcF5ZSYMS4JTLjteaAMARRSaeSh \
          --url https://api.devnet.solana.com
        ```

        3. Upgrade and deploy your program to localhost:
          <Tabs>
            <Tab title="Rust Native">
              ```bash
            cargo build-sbf
            solana config set --url localhost
            solana program deploy YOUR_PROGRAM_PATH
              ```
            </Tab>
            <Tab title="Anchor">
              ```bash
            anchor build && anchor deploy \
            --provider.cluster localnet
              ```
            </Tab>
          </Tabs>
      </Step>

      <Step title="Install and run MagicBlock ER validator (Localhost)">
        1. Install the latest MagicBlock Ephemeral Validator:
        ```bash
        npm install -g @magicblock-labs/ephemeral-validator@latest
        ```

        2. Run the local ephemeral validator pointing to localhost:
        ```bash
        RUST_LOG=info ephemeral-validator \
          --accounts-lifecycle ephemeral \
          --remote-cluster development \
          --remote-url http://127.0.0.1:8899 \
          --remote-ws-url ws://127.0.0.1:8900 \
          --rpc-port 7799
        ```
      </Step>

      <Step title="Test program instructions and delegation (Localhost)">
        Run your tests against the local ephemeral validator:

      <Tabs>
        <Tab title="Rust Native">
          ```bash
        EPHEMERAL_PROVIDER_ENDPOINT=http://localhost:7799 \
        EPHEMERAL_WS_ENDPOINT=ws://localhost:7800 \
        PROVIDER_ENDPOINT=http://localhost:8899 \
        WS_ENDPOINT=http://localhost:8900 \
        yarn test
          ```
        </Tab>
        <Tab title="Anchor">
          ```bash
        EPHEMERAL_PROVIDER_ENDPOINT="http://localhost:7799" \
        EPHEMERAL_WS_ENDPOINT="ws://localhost:7800" \
        anchor test \
          --provider.cluster localnet \
          --skip-local-validator \
          --skip-build \
          --skip-deploy
          ```
        </Tab>
      </Tabs>
      </Step>
    </Steps>

  </Tab>
  <Tab title="devnet">
    <Steps>
      <Step title="Upgrade and deploy program on Devnet">
        Upgrade your program with MagicBlock delegation and deploy it to Devnet:

        <Tabs>
          <Tab title="Rust Native">
            ```bash
          cargo build-sbf
          solana config set --url devnet
          solana program deploy YOUR_PROGRAM_PATH
            ```
          </Tab>
          <Tab title="Anchor">
            ```bash
          anchor build && anchor deploy \
          --provider.cluster devnet
            ```
          </Tab>
        </Tabs>

      </Step>

      <Step title="Install and run MagicBlock ER validator (Devnet)">
        1. Install the latest MagicBlock Ephemeral Validator:
        ```bash
        npm install -g @magicblock-labs/ephemeral-validator@latest
        ```

        2. Run the local ephemeral validator pointing to Devnet:
        ```bash
        RUST_LOG=info ephemeral-validator \
          --accounts-lifecycle ephemeral \
          --remote-url "https://rpc.magicblock.app/devnet" \
          --rpc-port 7799
        ```
      </Step>

      <Step title="Test program instructions and delegation (Devnet)">
        Run your tests against the local ephemeral validator:
      <Tabs>
        <Tab title="Rust Native">
          ```bash
        EPHEMERAL_PROVIDER_ENDPOINT=http://localhost:7799 \
        EPHEMERAL_WS_ENDPOINT=ws://localhost:7800 \
        yarn test
          ```
        </Tab>
        <Tab title="Anchor">
          ```bash
        EPHEMERAL_PROVIDER_ENDPOINT="http://localhost:7799" \
        EPHEMERAL_WS_ENDPOINT="ws://localhost:7800" \
        anchor test \
          --provider.cluster devnet \
          --skip-local-validator \
          --skip-build \
          --skip-deploy
          ```
        </Tab>
      </Tabs>
      </Step>
    </Steps>

  </Tab>
</Tabs>

Explore delegation and test scripts for both Anchor and Native Rust:

<CardGroup cols={2}>
  <Card
    title="Anchor"
    icon="anchor"
    href="/pages/ephemeral-rollups-ers/how-to-guide/anchor"
    iconType="duotone"
  >
    Integrate with an Anchor program
  </Card>
  <Card
    title="Native Rust"
    icon="rust"
    href="/pages/ephemeral-rollups-ers/how-to-guide/rust"
    iconType="duotone"
  >
    Integrate with a Native Rust program
  </Card>
</CardGroup>
